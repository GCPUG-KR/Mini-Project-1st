# 컨트리뷰터
- 이용운(Roy Lee) yongwoonyo@gmail.com

# 인트로
- 이 컨텐츠는 Google Cloud Platform User Group Korea 커뮤니티에서 제작한 컨텐츠로, 컨텐츠 작성 시 GCP 공식 문서를 참고하였으며 개인적인 견해가 많이 반영되어 있음을 밝힙니다.
- 내용 정정 혹은 기술 논의가 필요하신 경우 언제든 부담없이 커뮤니티에 방문하셔서 의견 남겨주세요.
- 이 자료는 자유롭게 배포 및 공유가 가능하며 배포 혹은 공유 시 아래 커뮤니티 주소를 함께 게재하시어 출처를 밝혀주시면 감사하겠습니다.
- 모델의 성능 보다는 AutoML Tables를 활용해서 얼마나 쉽게 머신러닝 모델을 만들 수 있는지에 초점을 두고 작성한 컨텐츠입니다.
- 커뮤니티 주소 : https://www.facebook.com/groups/googlecloudkorea/

2018년 샌프란시스코에서 열린 Google NEXT에 참가해서 AutoML을 처음 접했을 때 굉장히 인상적이었습니다.
그런데 불과 2년 남짓 지났을까 .. AutoML 하위 서비스들이 줄줄이 비엔나로 쏟아져 나오고, 발전하고 있어서 다시 한번 놀랐습니다.

# AutoML Tables

## AutoML 하위 서비스들
2020-06 기준, 사용 가능한 AutoML 하위 서비스들을 읊어보자면 
- AutoML Vision
- AutoML Video Intelligence
- AutoML Natural Language
- AutoML Translation
- AutoML Tables

가 존재합니다. 이 중 AutoML Tables에 대해 살펴보려고 합니다.

## AutoML Tables 제약사항
- 지도 학습만 가능합니다.
- 지도 학습이기에 레이블로 삼을 Target 컬럼이 필요합니다.
- 학습시킬 피처가 될, 컬럼은 최소 2개에서 1,000개까지 입력 가능합니다.
- 학습시킬 데이터는 100GB 이하이어야 합니다.
- 학습시킬 데이터 레코드 수는 1,000개 이상이어야 합니다. 다양한 모델을 활용하기 위해서는 최소 2,000 레코드 수 이상의 데이터가 있어야 무난한 것 같습니다.
- 학습시킬 데이터 레코드 수는 최대 1억개까지 가능합니다.
- 멀티 클래스로 분류하는 것도 지원하며 500개의 클래스까지 분류할 수 있습니다. 하지만 클래스별로 균형적인 비율로 그리고 2,000 레코드 수 보다는 더 많은 데이터가 있어야 적당히 성능을 내는 것 같습니다.
- 입력 데이터 컬럼명에 dot(.)가 있거나, 첫글자가 under score(_)인 경우 AutoML 데이터셋을 구성하는 과정에서 에러가 발생합니다.

## 입력 데이터
Cloud Storage, BigQuery에 있는 데이터는 바로 AutoML Tables 학습 데이터로 삼을 수 있습니다. 학습할 데이터가 Cloud Storage, BigQuery에 없다면 GCP 웹 콘솔에서 간단히 업로드 하실 수 있습니다.
### Cloud Storage
아시다시피 머신러닝 학습 데이터로 가장 많이 사용되는 파일 포맷 가운데 하나는 CSV 입니다. GCP의 Cloud Storage 라는 원격 파일 저장소에 CSV 파일을 업로드해두고 학습 데이터로 연동하시면 무난합니다.
### BigQuery
평소 서비스 데이터를 BigQuery에 저장해오셨다면, 쿼리만 수행해서 학습 데이터를 만들고 AutoML Tables에 바로 전달할 수 있습니다.
#### 주의사항
- US, EU에 존재하는 데이트셋이어야만 AutoML Tables로 연계 가능합니다.
- Cloud Storage 혹은 BigQuery 가운데 어느 쪽을 택하시던지 간에 reader, viewer 권한을 부여해주셔야 AutoML Tables가 데이터를 읽을 수 있습니다.
#### 이 컨텐츠에서는
House Prices 를 예측하는 것을 다룹니다. 관련 데이터는 아래 캐글 링크에서 다운로드할 수 있습니다.
- https://www.kaggle.com/c/house-prices-advanced-regression-techniques/data?select=train.csv
- https://www.kaggle.com/c/house-prices-advanced-regression-techniques/data?select=test.csv

## AutoML Tables를 사용해본 후기
### 정말 AutoML Tables를 사용하면 간단하게 머신러닝 모델을 만들 수 있는가?
제가 AutoML Tables를 이용해서 머신러닝 모델을 만들었던 과정을 요약해보자면 다음 정도의 일만 수행했습니다.

- 캐글에서 데이터 다운로드
- 다운로드한 데이터를 GCS에 업로드
- 업로드된 데이터를 AutoML Tables가 데이터셋으로 불러올 수 있도록 파이썬 코드 20줄 정도 작성
- AutoML Tables가 모델을 학습하도록, 머신러닝과 무관한 파이썬 코드를 10줄 이내로 작성
- 학습된 모델로 예측을 하도록 머신러닝과 무관한 파이썬 코드를 10줄 이내로 작성 

돌이켜보면, 정말 간단하게 머신러닝 모델을 만들 수 있었다라고 할 수 있습니다. 

보통 머신러닝 모델을 만들 때는 데이터 분포를 확인한 후 feature transform, selection, importance 등을 살펴보는 노가다(?)를 며칠에서 몇주를 한 후, 적합한 모델 네트워크를 구성하고 이를 앙상블로 엮는 작업을 몇주에서 몇달 정도 2차 노가다를 하고 나서, 몇주 정도 또 하이퍼파라미터 튜닝하는 시간을 쓰고 .. 여기까지 잘 풀리면 한번만에 모델을 완성시키는 것이고 결론이 실패로 귀결되면 다시 처음 과정부터 반복하게 되어서 최소 몇달 정도의 시간이 걸리곤 합니다. 그런데 AutoML Tables를 활용해서 하루 만에 머신러닝 모델을 만들 수 있다니, 이것은 센세이션입니다. 강추x2 :)

### 어떤 점이 가장 신경쓰였는가? 
입력 데이터에 대한 제약을 확실히 확인해야합니다. 다르게 말하자면 입력해줄 데이터 말고는 신경쓸게 딱히 없기 때문이기도 합니다 ^^a

이 컨텐츠를 만들면서 접한 에러들이 꽤 많은데 대부분 입력 데이터에 대한 에러였습니다.

- 1,000개 rows 보다 적어서 데이터셋 생성 실패
- 1,000개 row 보다 많은 데이터를 활용했음에도 불구하고 50% 이상의 데이터가 유효하지 않아서 모델 학습 실패
- 입력 데이터의 컬럼명에 dot(.)이 들어 있어서 에러 발생
- 어떤 문자가 포함되어서 에러를 내는지 이유를 알려주지 않는? 컬럼명 관련 에러
- 데이터, 데이터, ..

### 관련 에러 스크린샷


# 보너스 트랙: 지극히 개인적인 GCP AI Services 특징 비교
- AI Platform : ML 모델 개발 자유도가 가장 높습니다. 어떤 ML 알고리즘이던지 다 만들 수 있습니다. ML 모델 학습, 예측, 모델 버저닝 관리, 하이퍼튜닝 등 ML 프로덕트를 만들 때 필요한 기능 대부분을 지원하나, 데이터 사이언티스트가 하나 하나 다 만져줘야 합니다. 데이터 사이언티스트 역량에 따라 모델의 성능 격차가 가장 심하게 나는 도구입니다. 프로덕트를 만들기까지 시간이 가장 오래 걸립니다. 하지만 사용자 데이터에 가장 적합한 모델을 만들 가능성이 높습니다.
- BigQuery ML : 지도학습, 비지도학습 모두 지원합니다. SQL 문장 만으로도 머신러닝 학습, 예측 모두 가능하다는 장점이 있습니다. Google이 지원해주는 모델 가운데 골라서 지정해줘야 하는 방식입니다. 즉, 사용자가 원하는 알고리즘으로 풀 수 없는 문제는 BigQuery ML로 풀 수 없습니다. 프로덕트를 만들기까지의 시간은 조금 필요한 편입니다. 허나 AI Platform으로 만드는 것에 비해서는 시간 소모가 1/10도 걸리지 않습니다. BigQuery ML이 AI Platform 보다 빠르다는 이야기가 아니라 개발자가 손댈 것이 적다는 의미입니다.
- AutoML Tables : 머신러닝 알고리즘을 정해줄 필요가 없습니다. 지도학습만 지원합니다. 사용자가 입력한 label 데이터를 보고 어떤 ML 알고리즘으로 풀어야 할지 알아서 결정한 후 선형 회귀, 이진 분류, 멀티 클래스 분류, 앙상블 등 상황에 맞게 모델 네트워크를 구성해서 학습하고 예측하는 도구라서 즉, 데이터에 따라 범용적으로 쓸 수 있는 ML 서비스라서 AutoML blah blah 서비스들 보다는 한단계 위 레벨의 서비스처럼 느껴지네요. 지도학습만 지원한다고 해서 BigQuery ML 보다 적은 수의 ML 알고리즘을 지원한다는 의미는 아닙니다. 넉넉하게 이틀 내에 AutoML Tables로 머신러닝 학습, 예측 모두 수행해볼 수 있습니다.
- AutoML blah blah : OCR 인식, 비디오 장면 전환, 오브젝트 트래킹, 자연어 처리 등 사용자가 쓸만한 것들을 Google이 미리 만들어 둔 서비스입니다. 파이썬 코드로 30분 정도 뚝딱거리면 대강 연동 가능합니다. 지도학습, 비지도학습 같은 개념을 전혀 몰라도 사용 가능합니다. Google이 이미 학습해둔 모델로 예측을 해주는 방식이라서 애플리케이션에서는 해당 SaaS API 연동만 하면 끝납니다.
